(()=>{"use strict";var e={},t={};const n={player:{color:new class{r;g;b;a;constructor(e,t,n,o=255){this.r=e,this.g=t,this.b=n,this.a=o}toDOM(){return`rgba(${this.r}, ${this.g}, ${this.b}, ${this.a/255})`}}(255,50,50),validConnections:["player"]}};var o,i;o={"Player joined":{name:"Player joined",hoverTip:"Event is triggered when player joins server",motionStart:!1,motionNext:!0,inputs:[],outputs:[{name:"Player",hoverTip:"Player that joined server",type:"player"}],isEvent:!0}},e={...e,...o},i=n,t={...t,...i};const l={};function r(e,t,n=0){l[e]=l[e]||[],l[e].push({callback:t,priority:n})}var d=null,a=null,s=null,c=null,u={width:1280,height:720},y={x:0,y:0},p=1;function h(e){return e.x+e.width>=0&&e.y+e.height>=0&&e.x<=u.width&&e.y<=u.height}function m(){let e=window.innerWidth,t=window.innerHeight;u.width=e,u.height=t,d.canvas.width=e,d.canvas.height=t}!function(){if(d&&a&&s&&c)return;let e=document.getElementById("editor-canvas");d=e?.getContext("2d"),a=document.getElementById("editor-window"),s=document.getElementById("editor-canvas"),c=document.querySelector(":root"),m(),addEventListener("resize",m)}(),requestAnimationFrame((function e(){requestAnimationFrame(e),function(e,...t){l[e]&&l[e].sort(((e,t)=>t.priority-e.priority)).forEach((e=>{e.callback(...t)}))}("editorUpdate")}));const f="qwsertyuiopasdfghjklzxcvbnbmQWERETYUIOPASDFDGHJKJLZXCXVBNBM123454567890";function g(e=16){let t="";for(;t.length<e;)t+=f.charAt(Math.random()*f.length);return t}new Date;const v={x:0,y:0};function x(e){s.style.cursor=e,new Date}function k(e){return v.x>=e.x&&v.y>=e.y&&v.x<=e.x+e.width&&v.y<=e.y+e.height}addEventListener("mousemove",(function(e){v.x=e.clientX,v.y=e.clientY})),addEventListener("mousedown",(e=>{let t=new CustomEvent("mousePressed",{detail:{button:e.button}});window.dispatchEvent(t)})),addEventListener("mouseup",(e=>{let t=new CustomEvent("mouseReleased",{detail:{button:e.button}});window.dispatchEvent(t)})),r("editorUpdate",(function(){x("default")}),1e3);const b={};addEventListener("keydown",(e=>{b[e.key]=!0;let t=new CustomEvent("keyPressed",{detail:{key:e.key}});window.dispatchEvent(t)})),addEventListener("keyup",(e=>{b[e.key]=!1;let t=new CustomEvent("keyReleased",{detail:{key:e.key}});window.dispatchEvent(t)}));var w={active:!1,holding:!1,x:0,y:0};function E(e,t){return{x:(e-u.width/2-y.x*p)/p,y:(t-u.height/2-y.y*p)/p}}r("editorUpdate",(function(){if(w.active=b[" "]&&null==function(){for(let e of $)if(k(C(e).getBoundingClientRect()))return e;return null}(),w.active&&x("grab"),!w.holding)return;let e=v.x-w.x,t=v.y-w.y;y.x+=e/p,y.y+=t/p,w.x=v.x,w.y=v.y,c.style.setProperty("--board-x",`${y.x}px`),c.style.setProperty("--board-y",`${y.y}px`)}),1),addEventListener("mousePressed",(e=>{0==e.detail.button&&w.active&&(w.holding=!0,w.x=v.x,w.y=v.y)})),addEventListener("mouseReleased",(e=>{0==e.detail.button&&w.holding&&(w.holding=!1)})),addEventListener("wheel",(e=>{var t,n;n=p-e.deltaY/400,t=Math.min(Math.max(n,.2),4),p=t,c.style.setProperty("--board-zoom",`${p}`)}));var $=[];function P(e,n){let o=document.createElement("div"),i=document.createElement("div"),l=document.createElement("div"),r=(d=e.type,t[d]);var d;return i.innerText=e.name,o.appendChild("input"==n?l:i),o.appendChild("input"==n?i:l),l.style.setProperty("--color",r?.color.toDOM()||"red"),l.classList.add("block-ball"),o.classList.add("block-row"),o.classList.add(`block-${n}`),o}function C(t){let n=L(t);if(!n)return;let o=document.getElementById(`block-${n.token}`);return o||(o=function(t){let n=(o=t.type,e[o]);var o;if(!n)return;let i=document.createElement("div");i.classList.add("block-element"),i.id=`block-${t.token}`,a.appendChild(i);let l=document.createElement("div");l.innerText=n.name,l.classList.add("block-title");let r=document.createElement("div");r.classList.add("block-content");let d=document.createElement("div");d.classList.add("block-inputs"),n.inputs.forEach((e=>{let t=P(e,"input");d.appendChild(t)}));let s=document.createElement("div");return s.classList.add("block-outputs"),n.outputs.forEach((e=>{let t=P(e,"output");s.appendChild(t)})),r.appendChild(d),r.appendChild(s),i.appendChild(l),i.appendChild(r),i}(n)),o}function T(e,t,n){t=t||E(v.x,v.y).x,n=n||E(v.x,v.y).y;let o={token:g(),type:e,inputNodes:[],outputNodes:[],x:t,y:n};return $.push(o),function(e){let t=C(e),n=L(e);t&&(t.style.setProperty("--position-x",`${n.x}px`),t.style.setProperty("--position-y",`${n.y}px`))}(o),o}function L(e){return"string"!=typeof e?e:$.find((t=>t.token==e))}function B(e){if(function(e){let t=C(e);t&&t.remove()}(e),"string"==typeof e)return $=$.filter(((t,n)=>t.token!=e)),!0;{const t=$.indexOf(e);if(-1!==t)return $.splice(t,1),!0}return!1}function j(e){let t=C(e);if(t)return h(t.getBoundingClientRect())}r("editorUpdate",(function(){let e=!0;for(let t of $){if(!j(t))continue;let n=C(t).querySelector(".block-title").getBoundingClientRect();h(n)&&k(n)&&!w.holding&&(x("grab"),e=!1)}}),0);var D,M=1;async function S(e,t){if("AsyncFunction"===t.constructor.name){try{await t()?console.log(`✔️ Test ${M} "${e}" passed`):console.log(`❌ Test ${M} "${e}" failed`)}catch(t){console.log(`❌ Test ${M} "${e}" failed: ${t}`)}M++}else{try{t()?console.log(`✔️ Test ${M} "${e}" passed`):console.log(`❌ Test ${M} "${e}" failed`)}catch(t){console.log(`❌ Test ${M} "${e}" failed: ${t}`)}M++}}S("create block",(()=>"Player joined"==(D=T("Player joined")).type)),S("destroy block",(()=>B(D))),S("destroy block via token",(()=>B(D.token))),S("destroy invalid block",(()=>!B(null))),S("create block at 50x50 position",(()=>{let e=50==(D=T("Player joined",50,50)).x&&50==D.y;return B(D),e})),S("created block should create DOM element",(()=>{D=T("Player joined",50,50);let e=document.getElementById(`block-${D.token}`);return B(D),!!e})),S("destroying block should delete DOM element",(()=>{D=T("Player joined",50,50);let e=document.getElementById(`block-${D.token}`);B(D);let t=document.getElementById(`block-${D.token}`);return e&&!t})),S("create block for testing frontend purposes",(()=>!!(D=T("Player joined",50,50)))),S("clicking should create block on cursor position",(async()=>{let e=new Promise(((e,t)=>{addEventListener("mousePressed",(()=>{for(let t=0;t<50;t++){let n=T("Player joined",E(v.x,v.y).x+250*t,E(v.x,v.y).y);e(n.x==E(v.x,v.y).x&&n.y==E(v.x,v.y).y)}}))}));return await e}));const F={lastFrame:new Date,frameTime:[]};r("editorUpdate",(()=>{d.clearRect(0,0,u.width,u.height);let e=(new Date).getTime()-F.lastFrame.getTime();F.frameTime.push(e),d.font="10px 'Open Sans', sans-serif",d.fillStyle="#FFffffCC",d.textBaseline="middle",d.fillText("frame time",15,15),function(e,t,n,o,i,l=10,r=null){l=(i=i.slice(-l)).length,d.fillStyle="white",d.strokeStyle="white",d.lineWidth=1,d.strokeRect(e,t,n,o);let a=Math.max(...i,r);d.font="8px 'Open Sans', sans-serif";for(let n=0;n<5;n++){let i=n/4;d.fillText(Math.floor(a+(0-a)*i).toString(),e-13,t+3+(o-6)*i)}d.beginPath();let s=!1;for(let r=0;r<l;r++){let c=e+r/(l-1)*n,u=t+o-o*(i[r]/a);s||(d.moveTo(c,u),s=!0),d.lineTo(c,u)}d.stroke()}(15,25,250,130,F.frameTime,100,50),F.lastFrame=new Date}),999)})();